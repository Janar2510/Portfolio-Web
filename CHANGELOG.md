# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Fixed
- Portfolio site creation authentication issue - fixed async createClient() calls in API routes
- Missing `/portfolio/settings` route - created settings page with general, projects, submissions, and domain tabs
- Missing `/api/portfolio/forms/submissions` API route - implemented with pagination and filtering
- Form block submission handler - now submits to public API endpoint
- Projects block data fetching - now fetches actual projects from database with filtering
- FormSubmissionsManager API response parsing - fixed to correctly extract data from response
- BlockRenderer now passes siteId to blocks for public page rendering
- Public form submission API - fixed async createClient() call

### Added
- Copyfolio-style Template & Editor System (Part 1)
  - Comprehensive database schema upgrade for portfolio module
  - Extended portfolio_sites table with tagline, template tracking, SEO fields, and settings
  - Extended portfolio_templates table with slug, i18n fields, tags, preview images, features, industries, premium flags
  - Extended portfolio_pages table with page types, navigation settings, parent hierarchy, and page-level settings
  - Extended portfolio_blocks table with styles, layout, visibility, animation, and variant support
  - Renamed portfolio_styles to portfolio_site_styles with enhanced structure
  - New portfolio_sections table for reusable section library
  - New portfolio_media table for media library management
  - New portfolio_projects table (separate from projects module) for portfolio showcase items
  - New portfolio_edit_history table for undo/redo and change tracking
  - New portfolio_versions table for named snapshots and version history
  - New portfolio_form_submissions table for contact form and newsletter submissions
  - Comprehensive TypeScript types for all new schema structures
  - Block registry system with type-safe block registration
  - Block schema system with Zod validation for all block types
  - Support for block variants, animations, visibility controls, and layout settings
  - Enhanced style system with color palettes (including dark mode), typography, spacing, effects, and layout settings
  - Style presets system for saving and reusing style combinations
  - Media library with image optimization, thumbnails, and blurhash support
  - Portfolio projects with case study structure, gallery support, and featured images
  - Edit history tracking with operation-based undo/redo support
  - Version snapshots for full site state preservation
  - Form submission tracking with spam detection and status management
  - Database migration: `20240110000000_upgrade_portfolio_to_copyfolio_style.sql`
  - Comprehensive RLS policies for all new tables
  - Indexes optimized for common queries
  - Triggers for auto-creating site styles and tracking template usage
- Portfolio TypeScript types system
  - Complete type definitions in `/lib/portfolio/types.ts`
  - Type-safe interfaces for sites, templates, sections, pages, blocks, styles, media, projects, history, versions, and form submissions
  - Support for all new schema fields and structures
- Block registry and schema system
  - Centralized block registry with metadata, schemas, and component registration
  - Zod schemas for validating block content and settings
  - Support for block categories (layout, content, media, interactive, portfolio)
  - Block variant system for multiple layout options
  - Helper functions for creating and validating blocks
  - Type-safe block creation and updates
- Copyfolio-style Template & Editor System (Part 2)
  - Complete API routes for portfolio system
    - Templates API (list, get, apply)
    - Site API (CRUD, publish/unpublish)
    - Styles API (get, update)
    - Pages API (CRUD, get with blocks)
    - Blocks API (CRUD, reorder)
    - Sections API (list, get by category)
    - Public form submission endpoint with CORS
  - Editor state management with Zustand stores
    - Editor store (current page, selected block, preview mode, sidebar state)
    - Blocks store (block operations, clipboard, selection)
    - Styles store (color, typography, spacing, effects, presets)
    - History store (undo/redo, version management)
  - Template Gallery UI components
    - TemplateGallery with search and category filters
    - TemplateCard with hover effects and preview/use buttons
    - TemplatePreview modal with device frames (desktop/tablet/mobile)
    - Featured and premium template badges
  - Visual Editor core components
    - EditorLayout with responsive sidebar, canvas, and settings panel
    - EditorCanvas with drag-and-drop block reordering (dnd-kit)
    - EditorToolbar with undo/redo, save, publish, preview modes
    - EditorSidebar with tabs (blocks, pages, styles, settings)
    - EditorSettingsPanel for block and page settings
    - BlockPlaceholder for empty state
    - BlocksPanel with searchable block library
    - AddBlockModal for selecting new blocks
  - Editor hooks and functionality
    - useSavePage hook for saving page changes
    - useAddBlock hook for adding new blocks
    - useUpdateBlock hook for updating blocks
    - useDeleteBlock hook for deleting blocks
    - usePublishSite hook for publishing sites
    - Automatic history tracking for all operations
  - Portfolio service extensions
    - Media methods (get, upload, delete)
    - Portfolio projects methods (CRUD operations)
    - History methods (get, add entry)
    - Versions methods (get, create, get by id, delete)
    - Supabase Storage integration for media uploads
- Copyfolio-style Template & Editor System (Part 2 - UI Components)
  - Complete styles editor panels
    - ColorsPanel with color picker, palette editor, and preset system
    - TypographyPanel with font selection, size controls, weight settings, and live preview
    - SpacingPanel with spacing scale, section padding, container width, and border radius controls
    - EffectsPanel for animations, shadows, hover effects, and scroll animations
    - Integrated StylesPanel with tabbed interface for all style categories
  - Complete PagesPanel with page management
    - Page list with homepage indicator
    - Create new pages with title and slug
    - Delete pages (with homepage protection)
    - Navigate to pages
    - Page selection highlighting
  - Complete BlockSettingsPanel with comprehensive block editing
    - Tabbed interface (Content, Settings, Layout, Visibility)
    - Block-specific content fields (hero, text, image)
    - Block-specific settings (alignment, background, height, etc.)
    - Layout controls (width, padding, alignment)
    - Visibility controls (desktop/tablet/mobile)
    - Form integration with React Hook Form
  - Media Library component
    - Media grid with thumbnails
    - Upload functionality with Supabase Storage
    - Search and filter media
    - Media selection (single and multiple)
    - Delete media functionality
    - File type icons and metadata display
  - UI component additions
    - Slider component (Radix UI) for numeric inputs
    - Enhanced color picker with hex input
    - Font preview cards
    - Preset management UI
- Copyfolio-style Template & Editor System (Part 3 - Advanced Features)
  - Additional block implementations
    - ProjectGridBlock: Display portfolio projects in grid/masonry/list layouts with filtering
    - SkillsBlock: Visual skills display with bars, badges, grid, or circular layouts
    - StatsBlock: Animated statistics display with customizable layouts
    - All blocks integrated with BlockRenderer and block registry
  - Enhanced BlockSettingsPanel
    - Support for project-grid, skills, stats, gallery, video, and contact-form blocks
    - Advanced settings for all block types (layout, columns, visibility, etc.)
    - Tabbed interface (Content, Settings, Layout, Visibility)
    - Form integration with React Hook Form for all block types
  - Project Management UI
    - ProjectsManager component with full CRUD operations
    - Create, edit, and delete projects
    - Project cards with thumbnails, categories, and tags
    - Tag management with add/remove functionality
    - Category filtering and organization
    - Integration with PortfolioService for data persistence
  - Form Submissions Management
    - FormSubmissionsManager component to view all form submissions
    - Search and filter submissions
    - Detailed submission view with all form data
    - Export submissions to CSV
    - Mark submissions as read/unread
    - Reply to submissions via email
    - Integration with portfolio_form_submissions table
  - Custom Domain Configuration
    - DomainSettings component for managing custom domains
    - Add/remove custom domains
    - Domain verification status display
    - DNS configuration instructions (CNAME and A records)
    - SSL certificate status
    - Domain verification workflow
  - UI Component Additions
    - Progress component (Radix UI) for skill levels and progress bars
    - Alert component for notifications and warnings
    - Table component for data display (form submissions, etc.)
    - Enhanced SettingsPanel with tabs for Projects, Submissions, and Domain
  - Integration Updates
    - BlockRenderer updated to support all new block types
    - SettingsPanel integrated with ProjectsManager, FormSubmissionsManager, and DomainSettings
    - All components integrated with Zustand stores and React Query
- Pipedrive-style CRM system upgrade
  - Enhanced CRM service layer (CRMEnhancedService) with full Pipedrive-style API
  - LabelPicker component for managing and applying labels
  - CustomFieldRenderer component for rendering custom fields dynamically
  - ProductsList component for product catalog management
  - LeadsList component for lead management and conversion
  - NotesList component with pinning and editing support
  - Custom fields system for all entities (persons, organizations, deals, activities, products)
  - Multiple pipelines support (users can create and manage multiple sales pipelines)
  - Enhanced pipeline stages with rotten days tracking and stage types (normal/won/lost)
  - Products catalog with pricing, tax, and categories
  - Deal products linking (products added to deals with quantity, discount, tax)
  - Leads management system with conversion tracking
  - Labels system for tagging entities (persons, organizations, deals, leads)
  - Notes system with pinning and mentions
  - Files attachment system for all entities
  - Advanced filters and saved views
  - Goals tracking (revenue, deals won, activities, etc.)
  - Workflows/automations system with triggers and actions
  - Changelog tracking for all entity changes
  - Enhanced activities with duration, location, participants, reminders
  - Organizations (upgrade from companies) with enhanced fields
  - Persons (upgrade from contacts) with multiple emails/phones support
  - Enhanced deals with owner assignment, visibility settings, label support
  - Database migration functions for migrating existing data
- Comprehensive onboarding system (Copyfolio-style)
  - Multi-step onboarding flow (7 steps: Welcome, Profile, Template, Customize, Content, Tour, Publish)
  - Onboarding progress tracking with database persistence
  - Step-by-step progress indicator with visual stepper
  - User type selection (Freelancer, Agency, Business, Creative)
  - Primary goal selection (Portfolio, Clients, Both)
  - Template selection with preview
  - Site customization (name, subdomain, colors, fonts)
  - Content addition guidance
  - Feature tour with highlights
  - Publish flow with preview
  - Completion celebration page
  - Onboarding state management with Zustand
  - Onboarding events tracking for analytics
  - Feature checklist system for post-onboarding guidance
  - Tooltip dismissal tracking
  - Route guard to redirect incomplete users to onboarding
  - Full bilingual support (Estonian/English)
  - Skip functionality for optional steps
  - Resume capability (users can return to incomplete onboarding)
- Database tables for onboarding system
  - `onboarding_progress` - Tracks user progress through onboarding
  - `onboarding_events` - Analytics events during onboarding
  - `tooltip_dismissals` - Tracks dismissed contextual tooltips
  - `feature_checklist` - Tracks feature discovery progress
- Onboarding components
  - `OnboardingFlow` - Main flow controller
  - `OnboardingLayout` - Full-screen layout wrapper
  - `OnboardingProgress` - Visual progress stepper
  - `OnboardingNavigation` - Navigation buttons (Back/Continue/Skip)
  - Step components: `WelcomeStep`, `ProfileStep`, `TemplateStep`, `CustomizeStep`, `ContentStep`, `TourStep`, `PublishStep`
- Theme system (dark/light mode)
  - Custom ThemeProvider (no external dependencies)
  - ThemeToggle component with dropdown (Light/Dark/System)
  - Theme persistence in localStorage
  - System theme detection
  - Full dark mode support across all components
- Estonian as primary language
  - Default locale changed from 'en' to 'et'
  - Estonian first in locale list
- Missing UI components
  - DataTable component with sub-components (Container, Header, Body, Footer, Row, Cell, etc.)
  - StatCard component with trend indicators
  - ContactAvatar component with size variants (sm, md, lg)
- Portfolio site creation flow
  - CreateSiteDialog component with form validation
  - TemplateChooser component with category filtering
  - NoSiteView component for empty state
  - Site creation with template application
  - Subdomain validation and availability checking
- API implementation guide documenting all required API routes
- Component CSS updated to match exact specifications (pixel values)
- Contact avatar size variants (sm, md, lg)
- Complete navigation system for admin interface
  - TopNav component with logo, notifications, locale switcher, and user menu
  - Sidebar component with hierarchical navigation (dashboard, portfolio, projects, CRM, analytics, email)
  - Responsive navigation with mobile support
  - Quick actions section in sidebar (new contact, new project)
  - Status indicator in sidebar
  - Active route highlighting
  - Expandable navigation groups for nested routes
  - Dropdown menu component (Radix UI)
- Portfolio management page at `/portfolio` route
- Navigation translations for English and Estonian
- Admin layout wrapper with integrated TopNav and Sidebar
- Comprehensive frontend design system implementation
  - Brand color palette (Deep Teal primary, Warm Amber secondary)
  - Complete neutral gray scale
  - Semantic status colors (success, warning, error, info)
  - Module accent colors (portfolio, projects, CRM, analytics, email)
  - Dark mode color system with proper contrast
  - Typography system with Inter font stack and type scale (1.25 ratio)
  - Spacing system based on 4px base unit
  - Component utility classes (buttons, inputs, cards, tables, modals)
  - Typography patterns (headings, body, labels, captions)
  - Layout system with breakpoints and container max-widths
  - Complete border radius scale (none, sm, md, lg, xl, 2xl, 3xl, full)
  - Shadow scale (sm, md, lg, xl, 2xl, inner, primary, danger)
  - Animation system with timing functions and duration scale
  - Iconography system with size scale (xs, sm, md, lg, xl, 2xl)
  - Kanban board component utilities (columns, cards, drag states)
  - Portfolio editor component utilities (blocks, toolbar, preview frames)
  - Module-specific styles (CRM pipeline stages, deal values, contact avatars)
  - Analytics dashboard styles (stat cards, trend indicators)
  - Accessibility utilities (focus rings, skip links)
  - Extended Tailwind config with all design system tokens
  - Full dark mode support for all components and modules
- A/B testing system with experiment creation, variant management, and results visualization
- Experiment creation flow with target selection (page, block, style) and goal configuration
- Variant management interface for creating and editing test variants
- Experiment results dashboard with conversion rate comparison and statistical insights
- A/B testing page at `/analytics/ab-testing` with experiment lifecycle management
- Experiment status management (draft, running, paused, completed)
- Traffic split configuration for variant distribution
- Conversion goal tracking (pageview, click, form_submit)
- Variant performance comparison with improvement percentages
- Portfolio analytics dashboard at `/analytics/portfolio` with comprehensive metrics
- CRM analytics dashboard at `/analytics/crm` with performance insights
- MetricCard component for displaying key performance indicators
- SimpleChart component for visualizing time-series data
- Site selection and time period filtering for portfolio analytics
- Portfolio metrics: pageviews, unique visitors, form submissions, session duration
- Portfolio breakdowns: top pages, device types, referrers
- CRM metrics: contacts, companies, deals, pipeline value
- CRM breakdowns: deals by stage, activity types, top companies
- Activity and deal value charts over time
- Analytics tracking infrastructure with client-side event tracking
- Analytics event tracking script with visitor and session management
- Public tracking endpoint at `/api/analytics/track` with CORS support
- Daily aggregation edge function for analytics rollups
- AnalyticsScript component for embedding in public portfolio pages
- Automatic pageview, click, and form submission tracking
- Device type and browser detection
- UTM parameter tracking
- Session duration and bounce rate calculation
- Top pages, referrers, devices, and countries aggregation
- Email compose component with template support and variable substitution
- Email thread view component for CRM with reply/forward functionality
- Enhanced connected accounts management with sync button and status indicators
- Email threads page for contacts at `/crm/contacts/[id]/emails`
- Template variable editor in compose dialog
- Thread grouping UI with expandable email messages
- Email sync engine with edge function for automated synchronization
- Thread grouping algorithm for conversation organization
- Contact matching with confidence scoring (exact, domain, name, fuzzy)
- Email sync API route for manual and scheduled syncs
- Sync utilities for thread ID generation and email processing
- Deal association via contact matching
- Email sync engine documentation
- Email provider integrations with Microsoft Graph OAuth and Apple Mail IMAP
- Credential encryption utilities using AES-GCM
- Microsoft Graph OAuth flow with automatic token refresh
- Apple Mail IMAP connection with credential storage
- Provider abstraction layer for unified email provider interface
- OAuth callback API routes for Microsoft authentication
- Email accounts management page at `/email/accounts`
- Server-side IMAP/SMTP API routes (placeholders for implementation)
- Activities & Follow-ups system with comprehensive activity logging
- FollowUpReminders component for managing follow-up reminders
- NotificationsPanel component for centralized notification display
- Activities page at `/crm/activities` route with tabbed interface
- Enhanced ActivityTimeline with complete/incomplete toggles
- Follow-up notifications edge function
- Activity and follow-up status organization (overdue, today, tomorrow, completed)
- Priority-based notification sorting
- Pipeline board view with drag-and-drop deal management
- PipelineBoard component with stage and deal drag-and-drop
- DealCard component with value and probability display
- PipelineStage component with deal statistics
- DealDetailModal for viewing and editing deals
- StageCustomization component for managing pipeline stages
- Pipeline page at `/crm/pipeline` route
- Deal creation and management
- Stage reordering and customization
- Automatic deal close date when moved to won stage
- Contact management UI with list, filtering, and search
- Contact detail page with activity timeline
- Company management UI with list and contact association
- ActivityTimeline component for CRM activities
- ContactList component with advanced filtering (search, company, tags)
- CompanyList component with contact counts
- CRM routes: `/crm/contacts` and `/crm/companies`
- Contact detail route: `/crm/contacts/[id]`
- Badge UI component
- CRM data layer migration complete
- All CRM tables (companies, contacts, pipeline_stages, deals, crm_activities, follow_ups) migrated
- Comprehensive RLS policies (24 policies total)
- Database triggers for automatic data updates
- Performance indexes for optimized queries
- Calendar integration with month/week/day views
- CalendarView component with multiple view modes
- iCal feed generation API
- Due date notifications edge function for task reminders
- Calendar page at `/projects/calendar` route
- iCal export functionality for external calendar applications
- Task display in calendar with priority color coding
- Kanban board UI with drag-and-drop functionality
- ProjectList component for managing projects
- KanbanBoard component with column and task drag-and-drop
- TaskCard component with priority and due date indicators
- TaskDetailModal with subtasks and comments management
- Task detail editing (title, description, priority, due date)
- Subtasks/checklist with completion tracking
- Comments system with edit/delete functionality
- Project creation with default columns (To Do, In Progress, Done)
- Column reordering via drag-and-drop
- Task movement between columns via drag-and-drop
- Task reordering within columns via drag-and-drop
- Projects page at `/projects` route
- Initial project structure and architecture
- Monorepo setup with Turbo
- Next.js 14 application scaffold with App Router
- TypeScript configuration across all packages
- i18n implementation with next-intl (English and Estonian)
- Supabase client setup (browser, server, middleware)
- Service layer structure (Portfolio, Projects, CRM, Email)
- Shared packages (@portfolio/shared, @portfolio/database)
- Documentation (architecture.md, api-contracts.md, ai-rules.md)
- Directory structure for apps, packages, and Supabase functions
- Tailwind CSS with custom properties and gradient border animations
- Basic routing structure with locale support
- Protected admin routes with authentication
- Dashboard page with gradient border cards
- Environment variable templates
- Database migration for profiles and user_settings tables
- RLS policies for multi-tenant security
- Automatic profile creation trigger on user signup
- Profile service for managing user profiles and settings
- Portfolio module database migration (sites, pages, blocks, styles, templates)
- Comprehensive RLS policies for portfolio module (public read access for published content)
- Portfolio service with full CRUD operations for sites, pages, blocks, and styles
- Template system with apply functionality
- Block reordering support
- Project management module database migration (projects, columns, tasks, subtasks, comments, attachments)
- RLS policies for project management module
- Project service with full CRUD operations for projects, columns, tasks, subtasks, comments, and attachments
- Kanban board support with column and task reordering
- Automatic task completion when moved to done column
- Default column creation on project creation
- CRM module database migration (companies, contacts, pipeline stages, deals, activities, follow-ups)
- RLS policies for CRM module
- CRM service with full CRUD operations for all CRM entities
- Pipeline management with customizable stages
- Activity timeline tracking
- Follow-up reminder system
- Automatic contact last_contacted_at updates
- Automatic deal close date when moved to won stage
- Email integration module database migration (accounts, emails, templates)
- RLS policies for email module
- Email service with full CRUD operations for accounts, emails, and templates
- Email account management with encrypted credentials
- Email synchronization support with sync state tracking
- Email thread/conversation grouping
- Email linking to contacts and deals
- Automatic CRM activity creation from emails
- Email template system with variable substitution
- Analytics and A/B testing module database migration (events, experiments, variants, daily rollups)
- RLS policies for analytics module (public can insert events for published sites)
- Analytics service with event tracking and A/B testing support
- Event tracking with UTM parameters, device, browser, and country data
- A/B experiment management with variant tracking
- Automatic conversion tracking for A/B tests
- Daily analytics aggregation support
- Site analytics summary with key metrics
- Standardized RLS policy patterns across all migrations
- Updated portfolio_sites policy to combine public/owner access in single policy
- Updated analytics_events policy to allow anonymous inserts (WITH CHECK TRUE)
- Created RLS patterns documentation for consistency
- Added high-priority database indexes for common queries
- Optimized combined indexes for analytics_events, emails, and portfolio_blocks
- Comprehensive API contracts documentation with all endpoints
- API versioning with `/api/v1/` prefix
- Consistent response envelope format across all endpoints
- Detailed API request/response examples document
- JSON examples for common endpoints (tasks, contacts, deals, emails, analytics)
- Error response examples with different error scenarios
- Realtime subscriptions documentation with Supabase Realtime examples
- Reusable React hook for managing realtime subscriptions (useRealtimeSubscription)
- Channel examples for tasks, deals, CRM activities, and emails
- Best practices and performance considerations for realtime
- Prettier configuration for code formatting
- ESLint integration with Prettier
- Shadcn UI setup with components.json
- Tailwind CSS configuration with Shadcn UI theme
- Button component from Shadcn UI
- EditorConfig for consistent code style
- Setup documentation and development guides
- MCP server setup for Supabase integration
- MCP configuration files and setup script
- Documentation for Supabase MCP server (hosted and self-hosted options)
- Supabase project configuration (pcltfprbgwqmymmveloj)
- Setup scripts for Supabase project initialization
- Migration verification script
- Quick start guide with step-by-step instructions
- Auth provider configuration documentation
- Supabase project initialized and configured
- All migrations applied successfully
